<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/type.css">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <title>Document</title>
</head>
<style>

</style>

<body>
    <div class="typewriter container">
        <h1 id="app"></h1>
    </div>
    <button id="boton" class="waves-effect waves-light btn">boton xd</button>
    <script src="js/priority-queue.min.js"></script>
</body>

<script>
    class Nodo {
        constructor(count, symb, [a, b], digit) {
            this.digit = digit;
            this.count = count;
            this.symb = symb;
            this.children = [a, b];
        }
    }

    var msg = 'hola';

    buildCount = (msg) => {
        const obj = {};
        msg.split('').forEach(e => {
            if (!obj[e]) obj[e] = 0;
            obj[e] += 1;
        });
        return obj;
    }

    var count = buildCount(msg);
    buildTree = count => {
        const pq = new PriorityQueue({
            comparator: function (a, b) {
                return a.count - b.count;
            }
        });

        Object.entries(count).forEach(([k, v]) =>
            pq.queue(new Nodo(v, k, [null, null], null))
        );

        /*var size=pq.length;
        for (let i = 0; i < size; i++) {
            console.log(pq.dequeue());
        }*/
        var id = 0;
        while (pq.length) {
            const a = pq.dequeue();
            if (pq.length == 0)
                return a;
            const b = pq.dequeue();
            a.digit = 0;
            b.digit = 1;
            var value = a.count + b.count;
            pq.queue(new Nodo(value, 'r' + id, [a, b], null));
            id++;
        }
    }

    elements = [];
    edges = [];

    function dataSet(root, elements, edges) {

        elements.push(
            data = {
                "id": root.symb
            }
        );

        if (root.children[0] != null) {
            edges.push(
                data = {
                    "source": root.symb,
                    "target": root.children[0].symb
                }
            );
            dataSet(root.children[0], elements, edges);
        }

        if (root.children[1] != null) {
            edges.push(
                data = {
                    "source": root.symb,
                    "target": root.children[1].symb
                }
            );
            dataSet(root.children[1], elements, edges);
        }

        return null;
    }

    var arbol = buildTree(count);
    dataSet(arbol, elements, edges);

    console.log(buildCount(msg));
    console.log(arbol);
    console.log(elements);
    console.log(edges);

</script>